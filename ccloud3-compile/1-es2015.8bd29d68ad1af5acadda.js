(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"2ARg":function(e,t,i){"use strict";i.d(t,"a",function(){return l});var s=i("2Vo4"),n=i("8Y7J");const l=(()=>{class e{constructor(){this.eventSource=new s.a(null),this.events$=this.eventSource.asObservable()}emit(e){this.eventSource.next(e)}}return e.ngInjectableDef=n.tc({factory:function(){return new e},token:e,providedIn:"root"}),e})()},"3aSq":function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i("xj3x");class s{constructor(e,t,i){this.el=e,this.dragDropService=t,this.cdRef=i,this.element=this.el.nativeElement,this.dragDropService.showOuterHighLight.subscribe(e=>{0!==t.dragTargets.length&&(e?(this.cdRef.detach(),"start"===e.type&&this.addOuterElement(),e.rect&&this.scale&&this.scaleTo(e.rect.Width*e.scale,e.rect.Height*e.scale,e.rect.Y*e.scale,e.rect.X*e.scale)):(this.cdRef.reattach(),this.removeOuterElement()))})}scaleTo(e,t,i,s){this.outerElement&&(this.outerElement.style.width=e+"px",this.outerElement.style.height=t+"px",this.outerElement.style.top=i+"px",this.outerElement.style.left=s+"px",this.outerElement.style.right=null,this.outerElement.style.bottom=null)}createOuterElement(){const e=document.createElement("div");if(e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.right="0",e.style.bottom="0",e.style.pointerEvents="none",e.style.textAlign="center",e.style.fontSize="24px",e.style.lineHeight="30px",e.style.transition="200ms",this.color?(e.style.border=`4px dashed ${this.color}`,e.style.color=this.color):(e.style.border="4px dashed red",e.style.color="red"),this.text&&(e.innerText=this.text),this.styleSheet&&"object"==typeof this.styleSheet)for(const t of Object.keys(this.styleSheet))e.style[t]=this.styleSheet[t];return e}addOuterElement(){this.outerElement&&this.outerElement.parentNode===this.element||(this.outerElement=this.createOuterElement(),this.element.appendChild(this.outerElement))}removeOuterElement(){this.outerElement&&this.outerElement.parentNode===this.element&&this.outerElement.parentNode.removeChild(this.outerElement)}}},JjIB:function(e,t,i){"use strict";i.d(t,"a",function(){return l});var s=i("8Y7J"),n=(i("xj3x"),i("xgIS"));class l{constructor(e,t,i,l){this.elRef=e,this.dragDropService=t,this.ngZone=i,this.cdRef=l,this.dropEmitter=new s.p,this.element=e.nativeElement,this.ngZone.runOutsideAngular(()=>{this.dragoverSub=Object(n.a)(this.element,"dragover").subscribe(e=>{this.onDragOver(e)}),this.dragenterSub=Object(n.a)(this.element,"dragenter").subscribe(e=>{this.onDragEnter(e)}),this.dragleaveSub=Object(n.a)(this.element,"dragleave").subscribe(e=>{this.onDragLeave(e)})})}onDragOver(e){e.preventDefault(),e.target===this.element&&this.dropEmitter.emit({type:"over",data:null,ev:e})}onDrop(e){e.preventDefault(),e.target===this.element&&(this.backToNormal(this.element.children),this.dropEmitter.emit({type:"drop",data:this.dragDropService.dragTargets,ev:e}),this.cdRef.reattach())}onDragLeave(e){e.preventDefault(),e.target===this.element&&(this.backToNormal(this.element.children),this.dropEmitter.emit({type:"leave",data:null,ev:e}),this.cdRef.reattach())}onDragEnter(e){e.preventDefault(),this.forbiddenChildPointerEvents(this.element.children),this.element===e.target&&(this.cdRef.detach(),this.dropEmitter.emit({type:"enter",data:null,ev:e}))}forbiddenChildPointerEvents(e){for(let t=0;t<e.length;t++)e[t].style.pointerEvents="none"}backToNormal(e){for(let t=0;t<e.length;t++)e[t].style.pointerEvents="auto"}ngOnDestroy(){this.dragoverSub&&this.dragoverSub.unsubscribe(),this.dragenterSub&&this.dragenterSub.unsubscribe(),this.dragleaveSub&&this.dragleaveSub.unsubscribe()}}},K66B:function(e,t,i){"use strict";i.d(t,"a",function(){return s});class s{constructor(e){this.host=e,this.active=!1,this.selected=[]}setActive(){this.active=!0}setInactive(){this.active=!1}isActive(){return this.active}getElement(){return this.host.nativeElement}getId(){return this.id}initSelected(){this.selected.find(e=>e.id===this.id)?this.setActive():this.setInactive()}ngOnChanges(e){e.selected&&e.selected.currentValue&&this.initSelected()}}},St6j:function(e,t,i){"use strict";i.d(t,"a",function(){return o}),i.d(t,"b",function(){return h}),i("g0Zh"),i("w6Hz"),i("5fUb"),i("IyOr"),i("AfRD"),i("kJ5x"),i("JDDX"),i("2ARg");var s=i("AytR"),n=i("qV8f"),l=i("uBgS"),a=i("LvDl"),r=i("Kj3r"),c=i("gYh0");i("K66B");class o{static showMediaFilter(e){return e.hover||e.menuExpanded||e.groupChoose||e.partChoose}static showContentFilter(e,t,i){return e.hover||e.menuExpanded||t.some(e=>i.findIndex(t=>t.id===e.id)>-1)}static mouseEnterFilter(e){e.hover=!0}static mouseLeaveFilter(e){e.hover=!1}static menuOpen(e){e.menuExpanded=!0}static menuClose(e){e.hover=!1,e.menuExpanded=!1}}class h{constructor(e,t,i,s,n,c,o,h,d,u,g,m,f,p){this.mediaService=e,this.dialogRef=t,this.el=i,this.nav=s,this.infoService=n,this.router=c,this.createMedia=o,this.program=h,this.flowService=d,this.crequest=u,this.tracker=g,this.ele=m,this.store=f,this.cdR=p,this.medias=[],this.params={_embed:"true",per_page:"12",page:"1",status:"any"},this.isPC=!0,this.mediaSelected=[],this.selectedChangeSub=this.store.select(e=>e.mediaData.mediaSelected).subscribe(e=>{this.mediaSelected=a.cloneDeep(e),0===e.length&&this.unSelect()}),this.mediaViewUpdateSub=this.store.select(l.d).pipe(Object(r.a)(50)).subscribe(()=>{this.initSelection(this.boxes)})}initSelection(e){this.mediaMultiSelection=new c.a(e),this.activeChangeSub&&this.activeChangeSub.unsubscribe(),this.activeChangeSub=this.mediaMultiSelection.activeChanges$.subscribe(e=>{this.mediaSelected=e.map(e=>Object.assign({},e.content));const t=this.mediaSelected.slice().pop();this.mediaService.selectMedia=t,console.log(),this.store.dispatch(Object(n.l)({id:this.mediaSelected.length>0?t.id:null})),this.dispatchSelectedChange()})}ngAfterViewChecked(){this.cdR.detectChanges()}dispatchSelectedChange(){this.store.dispatch(Object(n.c)({selected:this.mediaSelected})),this.store.dispatch(Object(n.b)({selected:[]}))}showPreview(e){this.mediaService.updateSelectMedia(e,this.medias)}create(e){this.createMedia.sendMedia([e]),this.router.navigate(["/create",{type:"file"}])}download(e){const t=document.createElement("a"),i=document.createEvent("HTMLEvents");i.initEvent("click",!1,!1),t.href=e.source_url,t.download=e.name,t.dispatchEvent(i),t.click()}onSelect(){return!1}ngOnInit(){this.url=s.a.apiEndpoint+"/wp-json/wp/v2/programs/",this.listenClickEvent(),this.isPC=this.IsPC()}IsPC(){const e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let i=!0;for(let s=0;s<t.length;s++)if(e.indexOf(t[s])>0){i=!1;break}return i}listenClickEvent(){this.tracker.events$.subscribe(e=>{e&&e.uniqueKey&&"MEDIA"===e.uniqueKey&&this.unSelect()})}unSelect(){this.mediaService.selectMedia={name:"",src:""}}All(e){this.mediaSelected=this.unique(e.value),this.dispatchSelectedChange()}unique(e){return a.uniqWith(e.concat(this.mediaSelected),a.isEqual)}None(e){this.mediaSelected=this.mediaSelected.filter(t=>!e.value.find(e=>e.id===t.id)),this.dispatchSelectedChange()}ifProgram(e,t){t.selectNum=0,this.None(t);const i=t.value.filter(e=>e.attachment_program_detail.length>0),s=t.value.filter(e=>!(e.attachment_program_detail.length>0));this.mediaSelected=this.unique(e?i:s),this.dispatchSelectedChange()}ifSelectGroupAll(e){let t=!0;return e.value.forEach(e=>{this.mediaSelected.find(t=>t.id===e.id)||(t=!1)}),t}ifSelectGroupSome(e){const t=[];return e.value.forEach(e=>{this.mediaSelected.find(t=>t.id===e.id)?t.push(!0):t.push(!1)}),!!t.find(e=>!0===e)&&!t.every(e=>!1===e)&&!t.every(e=>!0===e)}ifGroupHasSelected(e){for(let t=0;t<e.value.length;t++)if(this.mediaSelected.find(i=>i.id===e.value[t].id))return!0}toggleMediaFilter(e,t){e.showFilter=t}ifShowMediaFilter(e){return!!e.menuExpened||e.showFilter||this.ifGroupHasSelected(e)&&!this.fromContents}filterMenuToggle(e,t){e.menuExpened=t}toggleMediaCheckbox(e,t){e.showCheckBox=t}ifMediaSelected(e){return!!this.mediaSelected.find(t=>t.id===e.id)}ifShowCheckBox(e){return this.ifMediaSelected(e)||!!e.showCheckBox}filterItem(e){this.ifSelectGroupAll(e)?this.None(e):this.All(e)}ngOnChanges(e){if(void 0!==e.medias){const t=e.medias.currentValue;this.previewMedias=t,this.medias=t}}ngOnDestroy(){this.selectedChangeSub.unsubscribe(),this.mediaViewUpdateSub.unsubscribe(),this.activeChangeSub&&this.activeChangeSub.unsubscribe(),this.mediaMultiSelection&&this.mediaMultiSelection.destroy()}}},c7dS:function(e,t,i){"use strict";var s=i("8Y7J"),n=i("Z5h4"),l=i("s7LF"),a=i("r0V8"),r=i("5GAg"),c=i("omvX"),o=i("6UMx"),h=i("Q+lL"),d=i("5ATD"),u=i("nHm3"),g=i("xj3x"),m=i("SVse"),f=i("TSSN"),p=i("15B3"),b=i("EoEU"),S=i("FYhI");i("j55m"),i.d(t,"a",function(){return v}),i.d(t,"b",function(){return D});var v=s.Nb({encapsulation:0,styles:[[".drag-list-container[_ngcontent-%COMP%]{position:relative;overflow:auto}.drag-list-container[_ngcontent-%COMP%]   .program-list[_ngcontent-%COMP%]{position:relative;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.drag-list-container[_ngcontent-%COMP%]   .program-list[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;height:41px}.drag-list-container[_ngcontent-%COMP%]   .program-list[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{position:absolute;top:10px;left:30px;color:#777777ab}.drag-list-container[_ngcontent-%COMP%]   .program-row[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:flex-start}"]],data:{}});function w(e){return s.rc(0,[(e()(),s.Pb(0,0,null,null,2,"mat-checkbox",[["class","mat-checkbox"]],[[8,"id",0],[1,"tabindex",0],[2,"mat-checkbox-indeterminate",null],[2,"mat-checkbox-checked",null],[2,"mat-checkbox-disabled",null],[2,"mat-checkbox-label-before",null],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"change"]],function(e,t,i){var s=!0,n=e.component;return"click"===t&&(s=!1!==i.stopPropagation()&&s),"change"===t&&(s=!1!==(i?n.toggleSection(e.parent.context.$implicit):null)&&s),s},n.b,n.a)),s.kc(5120,null,l.p,function(e){return[e]},[a.b]),s.Ob(2,8568832,null,0,a.b,[s.n,s.i,r.h,s.E,[8,null],[2,a.a],[2,c.a]],{checked:[0,"checked"],indeterminate:[1,"indeterminate"]},{change:"change"})],function(e,t){var i=t.component;e(t,2,0,i.isSectionAllSelected(t.parent.context.$implicit),i.isSectionSelected(t.parent.context.$implicit))},function(e,t){e(t,0,0,s.cc(t,2).id,null,s.cc(t,2).indeterminate,s.cc(t,2).checked,s.cc(t,2).disabled,"before"==s.cc(t,2).labelPosition,"NoopAnimations"===s.cc(t,2)._animationMode)})}function x(e){return s.rc(0,[(e()(),s.Pb(0,0,null,null,2,"mat-checkbox",[["class","mat-checkbox"]],[[8,"id",0],[1,"tabindex",0],[2,"mat-checkbox-indeterminate",null],[2,"mat-checkbox-checked",null],[2,"mat-checkbox-disabled",null],[2,"mat-checkbox-label-before",null],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"change"]],function(e,t,i){var s=!0,n=e.component;return"click"===t&&(s=!1!==i.stopPropagation()&&s),"change"===t&&(s=!1!==n.selectChange(e.parent.context.$implicit)&&s),s},n.b,n.a)),s.kc(5120,null,l.p,function(e){return[e]},[a.b]),s.Ob(2,8568832,null,0,a.b,[s.n,s.i,r.h,s.E,[8,null],[2,a.a],[2,c.a]],{checked:[0,"checked"]},{change:"change"})],function(e,t){e(t,2,0,t.component.selection.isSelected(t.parent.context.$implicit))},function(e,t){e(t,0,0,s.cc(t,2).id,null,s.cc(t,2).indeterminate,s.cc(t,2).checked,s.cc(t,2).disabled,"before"==s.cc(t,2).labelPosition,"NoopAnimations"===s.cc(t,2)._animationMode)})}function E(e){return s.rc(0,[(e()(),s.Pb(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function y(e){return s.rc(0,[(e()(),s.Pb(0,0,null,null,10,"mat-list-item",[["appDrag",""],["appInout",""],["class","program-row mat-list-item"],["role","listitem"]],[[2,"mat-list-item-avatar",null],[2,"mat-list-item-with-avatar",null]],[[null,"mouseenter"],[null,"mouseleave"],[null,"click"],[null,"dragstart"],[null,"dragend"]],function(e,t,i){var n=!0,l=e.component;return"mouseenter"===t&&(n=!1!==s.cc(e,5).onMouseEnter()&&n),"mouseleave"===t&&(n=!1!==s.cc(e,5).onMouseLeave()&&n),"dragstart"===t&&(n=!1!==s.cc(e,6).onDragStart(i)&&n),"dragend"===t&&(n=!1!==s.cc(e,6).ondragend(i)&&n),"mouseenter"===t&&(n=0!=(e.context.$implicit.hover=!0)&&n),"mouseleave"===t&&(n=0!=(e.context.$implicit.hover=!1)&&n),"click"===t&&(n=!1!==l.selectChange(e.context.$implicit)&&n),n},o.f,o.b)),s.Ob(1,1228800,null,3,h.c,[s.n,s.i,[2,h.g],[2,h.a]],null,null),s.lc(603979776,2,{_lines:1}),s.lc(603979776,3,{_avatar:0}),s.lc(603979776,4,{_icon:0}),s.Ob(5,16384,null,0,d.a,[s.n],{highlightBackground:[0,"highlightBackground"]},null),s.Ob(6,16384,null,0,u.a,[s.n,g.a],{currentTarget:[0,"currentTarget"],selected:[1,"selected"]},null),(e()(),s.zb(16777216,null,2,1,null,x)),s.Ob(8,16384,null,0,m.n,[s.W,s.T],{ngIf:[0,"ngIf"]},null),(e()(),s.zb(16777216,null,2,1,null,E)),s.Ob(10,540672,null,0,m.u,[s.W],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null)],function(e,t){var i=t.component;e(t,5,0,"boxShadow"),e(t,6,0,t.context.$implicit,i.selection.selected),e(t,8,0,i.ifShowCheckbox(t.context.$implicit)),e(t,10,0,t.context.$implicit,i.template)},function(e,t){e(t,0,0,s.cc(t,1)._avatar||s.cc(t,1)._icon,s.cc(t,1)._avatar||s.cc(t,1)._icon)})}function O(e){return s.rc(0,[(e()(),s.Pb(0,0,null,null,10,null,null,null,null,null,null,null)),(e()(),s.Pb(1,0,null,null,9,"mat-list",[["class","program-list mat-list mat-list-base"],["role","list"]],null,null,null,o.h,o.a)),s.Ob(2,704512,null,0,h.a,[s.n],null,null),(e()(),s.Pb(3,0,null,0,5,"div",[["class","section-header"]],null,[[null,"click"],[null,"mouseenter"],[null,"mouseleave"]],function(e,t,i){var s=!0,n=e.component;return"click"===t&&(s=!1!==n.toggleSection(e.context.$implicit)&&s),"mouseenter"===t&&(s=!1!==n.filterController.mouseEnterFilter(e.context.extra)&&s),"mouseleave"===t&&(s=!1!==n.filterController.mouseLeaveFilter(e.context.extra)&&s),s},null,null)),(e()(),s.zb(16777216,null,null,1,null,w)),s.Ob(5,16384,null,0,m.n,[s.W,s.T],{ngIf:[0,"ngIf"]},null),(e()(),s.Pb(6,0,null,null,2,"h5",[],null,null,null,null,null)),(e()(),s.oc(7,null,[""," ",""])),s.hc(131072,f.i,[f.j,s.i]),(e()(),s.zb(16777216,null,0,1,null,y)),s.Ob(10,278528,null,0,m.m,[s.W,s.T,s.v],{ngForOf:[0,"ngForOf"]},null)],function(e,t){var i=t.component;e(t,5,0,i.filterController.showContentFilter(t.context.extra,t.context.$implicit,i.selection.selected)),e(t,10,0,t.context.$implicit)},function(e,t){e(t,7,0,t.context.date,s.qc(t,7,1,s.cc(t,8).transform(t.context.day)))})}function D(e){return s.rc(0,[(e()(),s.Pb(0,0,null,null,5,"div",[["class","drag-list-container"]],null,null,null,null,null)),(e()(),s.Pb(1,0,null,null,4,"app-group-splitter",[],null,null,null,p.b,p.a)),s.Ob(2,49152,null,1,b.a,[],{groupStrategy:[0,"groupStrategy"],groupData:[1,"groupData"]},null),s.lc(335544320,1,{subGroup:0}),(e()(),s.zb(16777216,null,null,1,null,O)),s.Ob(5,16384,[[1,4]],0,S.a,[s.T,s.W],null,null)],function(e,t){var i=t.component;e(t,2,0,i.groupBy,i.contents)},null)}},gYh0:function(e,t,i){"use strict";i.d(t,"a",function(){return r});var s=i("XNiG"),n=i("VRyK"),l=i("xgIS"),a=i("lJxs");class r{constructor(e){this.items=e,this.activeChanges=new s.a,this.activeChanges$=this.activeChanges.asObservable(),this.lastIndex=JSON.parse(localStorage.getItem("lastIndex")),this.init()}init(){const e=this.getListeners();this.subscription&&this.subscription.unsubscribe(),this.subscription=Object(n.a)(...e).subscribe(({comp:e,isShift:t,isCtr:i,index:s})=>{if(!0===i)this.toggleChoose(e,s);else if(!0===t){const t=s,i=this.lastIndex,n=this.items.toArray().slice(Math.min(t,i),Math.max(t,i)+1),l=e.isActive();n.forEach(e=>l?e.setInactive():e.setActive())}else this.toggleChoose(e,s);this.activeChanges.next(this.getActives())})}toggleChoose(e,t){e.isActive()?e.setInactive():e.setActive(),this.lastIndex=t,localStorage.setItem("lastIndex",`${t}`)}getActives(){return this.items.filter(e=>e.isActive())}destroy(){this.subscription.unsubscribe()}deSelectAll(){this.items.forEach(e=>{e.setInactive()})}getListeners(){return this.items.map((e,t)=>Object(l.a)(e.getElement(),"click").pipe(Object(a.a)(i=>({index:t,isShift:i.shiftKey,isCtr:i.ctrlKey,comp:e}))))}}},j55m:function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i("xj3x");var s=i("EoEU"),n=i("St6j");class l{constructor(e){this.dragService=e,this.contents=[],this.groupBy=s.b.MODIFIED,this.filterController=n.a}isSectionAllSelected(e){return this.getSectionSelectLength(e)===e.length}isSectionSelected(e){const t=this.getSectionSelectLength(e);return t>0&&t<e.length}getSectionSelectLength(e){return this.selection.selected.filter(t=>{for(let i=0;i<e.length;i++)if(e[i].id===t.id)return!0}).length}toggleSection(e){this.isSectionAllSelected(e)?this.clearSection(e):this.selectSection(e),this.drawText()}selectChange(e){this.selection.toggle(e),this.drawText()}drawText(){this.dragService.draw(this.selection.selected.length)}clearSection(e){for(let t=0;t<e.length;t++)this.selection.deselect(e[t])}selectSection(e){for(let t=0;t<e.length;t++)this.selection.isSelected(e[t])||this.selection.select(e[t])}ifShowCheckbox(e){return!!this.selection.hasValue()||!!e.hover}}},nHm3:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i("xj3x");class s{constructor(e,t){this.elRef=e,this.dragDropService=t,this.reorderIndex=null,this.element=e.nativeElement,this.element.getAttribute("draggable")||this.element.setAttribute("draggable","true")}onDragStart(e){this.dragDropService.clear();const t=e.dataTransfer;if(t.effectAllowed="copy",!(this.currentTarget&&this.selected instanceof Array))return!1;this.selected.length>1&&this.selected.filter(e=>e.id===this.currentTarget.id).length>0?(t.setDragImage(this.dragDropService.dragImage,0,0),this.dragDropService.addAll(this.selected)):this.dragDropService.add(this.currentTarget),e.dataTransfer.setData("reorder",this.reorderIndex+""),null===this.reorderIndex&&this.dragDropService.showOuterHighLight.next({type:"start"})}ondragend(e){null===this.reorderIndex&&this.dragDropService.dragEndInit()}}},pH6K:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i("g0Zh");class s{constructor(e,t,i,s,n){this.mediaService=e,this.el=t,this.renderer2=i,this.dialog=s,this.data=n,this.selected=[],this.folders=[],this.folderSelected=[],this.moveTo=!1,this.loading=!1,this.path=[void 0],this.lastPath=void 0,this.showRoot=!1,this.showRight=!1,n&&(this.folderSelected=n.folderSelected,this.selected=n.selected.map(e=>e.id),n.folders?this.folders=n.folders:this.mediaService.getMediaFolders(1,100).subscribe(e=>{this.folders=e.folders,this.mediaService.allFolders=e.folders}))}disableFolder(e){return this.folderSelected.map(e=>e.id).indexOf(e)>-1}cancel(){this.dialog.close()}moveMedia(){this.moveTo=!1,0===this.select&&0===this.folderSelected.length&&(this.select=[]),this.selected.forEach(e=>{this.mediaService.moveTo(e,this.select).subscribe(e=>{this.dialog.close(e)})});const e={title:"",description:""};this.folderSelected.forEach(t=>{e.title=t.name,e.description=t.description,this.mediaService.moveFolder(this.select,t.id,e).subscribe(e=>{this.dialog.close(!0)})})}backPath(){this.loading=!0,void 0===this.lastPath?(this.showRoot=!0,this.lastPath=void 0,this.loading=!1,this.select=void 0):(this.showRoot=!1,this.mediaService.getMediaFolders(1,100,this.lastPath).subscribe(e=>{this.folders=e.folders,this.loading=!1,this.select=this.lastPath,this.path.pop(),this.lastPath=this.path[this.path.length-1]}))}enterFolder(e){this.select=e.id,this.loading=!0,0===e.id?(this.showRoot=!1,this.loading=!1):(this.lastPath=e.parent,this.path.push(this.lastPath),this.mediaService.getMediaFolders(1,100,e.id).subscribe(e=>{this.folders=e.folders,this.loading=!1}))}selectFolder(e){this.select=e===this.select?void 0:e}ngOnInit(){}}},uBgS:function(e,t,i){"use strict";i.d(t,"a",function(){return l}),i.d(t,"c",function(){return a}),i.d(t,"b",function(){return r}),i.d(t,"d",function(){return c}),i("l9NK"),i("4FSw");var s=i("y58h"),n=(i("+bt8"),i("KXJF"),i("DQLy"));const l=Object(n.x)(e=>e.mediaData,s.c),a=Object(n.x)(e=>e.mediaData,s.e),r=(Object(n.x)(e=>e.mediaData,s.b),Object(n.x)(e=>e.mediaData,s.d)),c=(Object(n.x)(e=>e.mediaData,s.a),Object(n.x)(e=>e.mediaData,s.g))},w6Hz:function(e,t,i){"use strict";i.d(t,"a",function(){return u});var s=i("8Y7J"),n=i("g0Zh"),l=i("pH6K"),a=(i("5fUb"),i("IyOr"),i("0gu+"),i("udsX")),r=i("MwwG"),c=i("xdDY"),o=i("uBgS"),h=i("qV8f"),d=i("Nr6V");class u{constructor(e,t,i,l,r,c,h,d,u){this.infoService=e,this.media=t,this.router=i,this.dialogRef=l,this.createMedia=r,this.authService=c,this.dialog=h,this.store=d,this.el=u,this.folders=[],this.isListView=!1,this.metaCaps={create:[a.a.CREATE_PROGRAM],delete:[a.a.READ_LOGS]},this.listView=new s.p,this.currentUser=this.authService.User,this.showDetailSub=this.store.select(e=>e.mediaData.ifShowDetail).subscribe(e=>{if(void 0===this.ifShowDetail){const e=localStorage.getItem("mediaDetail");e&&(this.ifShowDetail=JSON.parse(e).ifShowDetail)}else this.ifShowDetail=e}),this.delSub=this.media.judgeDelete.subscribe(e=>{this.canbeDelete=e}),this.fiSub=this.media.finishDeleteMedia.subscribe(e=>{this.canbeDelete=!e,e&&this.clearSelect()}),this.mediaFolderChange=this.store.select(o.b).subscribe(e=>{if(this.folders=e.folders,this.folderPath=this.folderPath?e.folderPath:n.a.getLocalFolderPath(),"number"!=typeof e.currentFolderId){const e=n.a.getLocalParams();this.parentNodeId="number"==typeof e.mfolder?e.mfolder:0}else this.parentNodeId=0}),this.mediaQueryParamsSub=this.store.select(e=>e.mediaData.mediaQueryParams).subscribe(e=>{this.mediaQueryParams=this.mediaQueryParams?e:n.a.getLocalParams()}),this.mediaStatusSub=this.store.select(e=>e.mediaData.mediaStatus).subscribe(e=>{this.mediaStatus=this.mediaStatus?e:n.a.getLocalMediaStatus()}),this.mediaSelectedChangeSub=this.store.select(e=>e.mediaData.mediaSelected).subscribe(e=>{this.mediaSelected=e}),this.folderSelectedChangeSub=this.store.select(e=>e.mediaData.folderSelected).subscribe(e=>{this.folderSelected=e})}ngOnDestroy(){this.showDetailSub.unsubscribe(),this.fiSub.unsubscribe(),this.delSub.unsubscribe(),this.mediaFolderChange.unsubscribe(),this.mediaQueryParamsSub.unsubscribe(),this.mediaStatusSub.unsubscribe(),this.mediaSelectedChangeSub.unsubscribe(),this.folderSelectedChangeSub.unsubscribe(),this.el.nativeElement.onclick=null}clearSelect(){this.store.dispatch(Object(h.c)({selected:[]})),this.store.dispatch(Object(h.b)({selected:[]}))}showPreview(){this.media.updateSelectMedia(this.media.selectMedia)}paramChange(e){this.mediaSearchParams=n.a.setSearchParam(e),localStorage.setItem("mediaSearchParams",JSON.stringify(this.mediaSearchParams)),n.a.ifSearch(this.mediaSearchParams)?this.store.dispatch(Object(h.j)({params:this.mediaSearchParams})):this.store.dispatch(Object(h.d)({params:this.mediaQueryParams})),this.store.dispatch(Object(h.c)({selected:[]}))}refreshMedia(){this.mediaStatus===d.a.SEARCH?this.store.dispatch(Object(h.j)({params:this.mediaSearchParams})):this.mediaStatus===d.a.QUERY&&this.store.dispatch(Object(h.d)({params:this.mediaQueryParams})),this.store.dispatch(Object(h.c)({selected:[]}))}toggleDetail(){this.ifShowDetail=!this.ifShowDetail,this.store.dispatch(Object(h.l)({open:this.ifShowDetail,id:null}))}changeView(){this.isListView=!this.isListView,this.listView.emit([this.isListView]),localStorage.setItem("ListView",JSON.stringify(this.isListView))}moveToFolder(e,t){this.folders=this.media.allFolders;const{dialogRef:i,dialogConfig:s}=this;e&&(s.data.selected=[e],s.data.folderSelected=[]),t&&(s.data.selected=[],s.data.folderSelected=[t]),this.mediaSelected.length>0&&(s.data.selected=this.mediaSelected),this.folderSelected&&this.folderSelected.length>0&&(s.data.folderSelected=this.folderSelected),i.open(l.a,s).afterClosed().subscribe(e=>{e&&(this.store.dispatch(Object(h.d)({params:{}})),this.store.dispatch(Object(h.c)({selected:[]})))})}getSelectedMediaExceptZip(){const e=this.mediaSelected;for(let t=0;t<e.length;t++)if(this.media.isUpgradePackage(e[t].file_type))return[];return e}canBeCreateProgram(){return this.getSelectedMediaExceptZip().length>0}createFile(){if(!this.currentUser.hasCapability(a.a.CREATE_PROGRAM))return!1;this.createMedia.sendMedia(this.getSelectedMediaExceptZip()),this.router.navigate(["/create",{type:"file"}])}get dialogConfig(){const{mediaSelected:e,folders:t,folderSelected:i}=this;return{data:{mediaSelected:e,folders:t,folderSelected:i},width:"300px"}}deleteFiles(e,t){"media"===t?this.media.deleteMedia(e[0]).subscribe(()=>{this.refreshMedia()}):"medias"===t?this.media.bulkDeleteMedia(e).subscribe(()=>{this.refreshMedia()}):"folder"===t&&this.media.bulkDeleteFolders(e).subscribe(e=>{this.store.dispatch(Object(h.f)({folderId:this.parentNodeId,param:{type:"refresh",folderPath:this.folderPath}})),this.store.dispatch(Object(h.d)({params:{}})),this.store.dispatch(Object(h.c)({selected:[]}))})}bulkDeleteMedias(){let e,t,i,s=[];1===this.mediaSelected.length&&(s=[this.mediaSelected[0].id],e=this.mediaSelected[0],t=!0,i="media"),this.mediaSelected.length>1&&(s=this.mediaSelected.map(e=>e.id),e={length:this.mediaSelected.length},t=!1,i="medias"),this.folderSelected.length>0&&(s=this.folderSelected.map(e=>e.id),1===this.folderSelected.length?(e=this.folderSelected[0],t=!0):(e={length:this.folderSelected.length},t=!1),i="folder"),this.dialog.open(r.a,{width:"450px",data:{file_info:e,isSingle:t,from:i}}).afterClosed().subscribe(e=>{e&&e.delete&&this.deleteFiles(s,e.type)})}ngOnInit(){this.isListView=JSON.parse(localStorage.getItem("ListView")),this.el.nativeElement.onclick=(()=>{this.store.dispatch(Object(h.c)({selected:[]}))})}ngOnChanges(e){void 0!==e.singleSelectG&&0!==e.singleSelectG.currentValue.length&&(this.canbeDelete=0===e.singleSelectG.currentValue[0].attachment_program.length),void 0!==e.singleSelect&&0!==e.singleSelect.currentValue.length&&(this.canbeDelete=0===e.singleSelect.currentValue[0].attachment_program.length)}canbeMoveToFolder(){return"share"!==this.media.selectedTab&&(this.mediaSelected.length>0||this.folderSelected.length>0)}canbeBulkDeleteMedias(){return(this.folderSelected.length>0||n.a.judge(this.mediaSelected))&&"own"===this.media.selectedTab}canShowPreview(){return 1===this.mediaSelected.length}get canShowBindTags(){return this.mediaSelected.length>0}bindTags(){this.dialog.open(c.a,{data:{media:this.mediaSelected},disableClose:!0,width:"400px"})}}},xj3x:function(e,t,i){"use strict";i.d(t,"b",function(){return r}),i.d(t,"c",function(){return c}),i.d(t,"a",function(){return o});var s=i("GmxD"),n=i("2Vo4"),l=i("8Y7J"),a=i("lwm9"),r=function(e){return e[e.LIST=0]="LIST",e[e.GRID=1]="GRID",e}({}),c=function(e){return e[e.NEW=0]="NEW",e[e.ADD=1]="ADD",e[e.OVERLAP=2]="OVERLAP",e[e.PAGE=3]="PAGE",e}({});const o=(()=>{class e{constructor(e){this._bottomSheet=e,this.dragTargets=[],this.showOuterHighLight=new n.a(null),this.tipRectColor={new:"red",add:"blue",multi:"yellow",page:"green"},this.insertIndex=0}dragEndInit(){this.showOuterHighLight.next(null),this.clear()}clear(){this.dragTargets=[]}add(e){this.dragTargets.push(e)}addAll(e){this.dragTargets=this.dragTargets.concat(e)}createCanvas(){const e=document.createElement("canvas");e.width=50,e.height=50,this.canvas=e}draw(e){this.createCanvas();const t=this.canvas.getContext("2d");t.beginPath(),t.fillStyle="red",t.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2,0,2*Math.PI),t.fill(),t.font=this.canvas.width+"px serif",t.fillStyle="#fff",t.textBaseline="hanging",t.textAlign="center",t.fillText(e,this.canvas.width/2,2),this.dragImage=new Image,this.dragImage.src=this.canvas.toDataURL("image/png",1)}dropToCreateFileWindow(e){e.windows.add("fileWindow"),this.addMediaToFileWindow(e)}dropToAddMediaToFileWindow(e,t){if(0===t.windows.get().length)return;const i=e.dataTransfer.getData("reorder");if("null"!==i){const e=t.windows.getSelected().children,s=e[i],n=this.getReorderIndex(e.length);return e[i]=e[n],void(e[n]=s)}const s=e.target;this.addMediaToFileWindow(t,null,0===s.offsetWidth?s.children[0]:s)}getReorderIndex(e){return this.insertIndex<=0?0:this.insertIndex>e-1?e-1:this.insertIndex-1}getListViewDropIndex(e){const t=e.offsetY,i=Math.floor(t/108);let s=i;return t>108*i+54&&(s+=1),this.listHighLight(e.target,s,108),s}getGridViewDropIndex(e){const t=0===e.target.offsetWidth?e.target.children[0]:e.target,i=t.offsetWidth,s=t.children.length;if(0===s)return 0;let n=e.offsetX,l=Math.ceil(e.offsetY/104);const a=Math.floor(i/104);let r=Math.floor(n/104);r>=a&&(l+=1,r=0,n=0);let c=(l-1)*a+r;return c>s-2&&(r=s-1-(l-1)*a),n>104*r+52&&c<=s-2&&(c+=1,r+=1),this.gridHighLight(t,l,r,104),c}gridHighLight(e,t,i,s){this.highLightElement&&this.highLightElement.parentNode===e||(this.highLightElement=this.createElement(5,s),e.appendChild(this.highLightElement)),this.highLightElement.style.left=i*s+"px",this.highLightElement.style.top=(t-1)*s+"px"}listHighLight(e,t,i){this.highLightElement&&this.highLightElement.parentNode===e||(this.highLightElement=this.createElement(e.offsetWidth,5),this.highLightElement.style.left="0px",e.appendChild(this.highLightElement)),this.highLightElement.style.top=t*i+"px"}createElement(e,t){const i=document.createElement("div");return i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width=e+"px",i.style.height=t+"px",i.style.backgroundColor="#1A73E8",i}removeHighlight(e){this.highLightElement&&this.highLightElement.parentNode===e&&e.removeChild(this.highLightElement)}selectFileWindowWhenDragOver(e,t){const i=t.windows.get(),s=this.getFileWindow(i);if(0===s.length)return;const n=this.getTargetWindow(s,e,t);if(!n||0===n.length)return;const l=n[n.length-1];if(!this.targetWindow||this.targetWindow.window.id!==l.window.id){this.targetWindow=l;const e=t.getContentInfo().info.Information.Scale;this.showOuterHighLight.next({rect:l.window.Rect,scale:e})}}getTargetWindow(e,t,i){const s=i.getContentInfo();if(!s)return;const n=s.info.Information.Scale,l=t.offsetX/n,a=t.offsetY/n;return e.filter(e=>l>e.window.Rect.X&&l<e.window.Rect.X+e.window.Rect.Width&&a>e.window.Rect.Y&&a<e.window.Rect.Y+e.window.Rect.Height)}dropToPreviewer(e,t){const i=t.windows.get(),s=this.getFileWindow(i);if(0===s.length)this.dropToCreateFileWindow(t);else{const i=this.getTargetWindow(s,e,t);if(!i)return;0===i.length?this.dropToCreateFileWindow(t):this.addMediaToFileWindow(t,1===i.length?i[0]:i[i.length-1])}}dropToAddPageAndCreateFileWindow(e){e.pages.add().initWindow(),this.dropToCreateFileWindow(e)}getFileWindow(e){return e&&e instanceof Array?e.map((e,t)=>{if("fileWindow"===e.type)return{window:e,index:t}}).filter(e=>!!e):[]}addMediaToFileWindow(e,t,i){let s;t?(s=t.window,e.windows.select(t.index)):s=e.windows.getSelected();const n=this.dragTargets.map(e=>this.formatMedia(e)).filter(e=>!!e);s.children&&s.children instanceof Array?i&&this.insertIndex<i.children.length?s.children.splice(this.insertIndex,0,...n):s.children=s.children.concat(n):s.children=n,e.emit("pageInfoChanged")}formatMedia(e){return Object.assign({},e,{fileID:e.id,id:Math.random(),Duration:e.duration||8e3,ReserveAS:0,playTime:e.duration/1e3||8,PlayTimes:"1",inEffect:{Name:"No Effect",Type:0,Time:1500,webTime:1.5},attachment_filesize:this.formatSize(e.attachment_filesize)})}formatSize(e){return e>=1048576?(e/1048576).toFixed(2)+" MB":e<1048576?(e/1024).toFixed(0)+" KB":void 0}openTipDialog(e){return this.closeTipDialog(),this._bottomSheetRef=this._bottomSheet.open(s.a,{data:e,hasBackdrop:!1}),this._bottomSheetRef}closeTipDialog(){this._bottomSheetRef&&this._bottomSheetRef.dismiss()}handleEvent(e,t,i,s){if(0!==this.dragTargets.length&&("drop"===t.type||"leave"===t.type?i===c.ADD&&this.removeHighlight(0===t.ev.target.offsetWidth?t.ev.target.children[0]:t.ev.target):"over"===t.type&&i===c.ADD?this.insertIndex=t.viewType===r.GRID?this.getGridViewDropIndex(t.ev):this.getListViewDropIndex(t.ev):"over"===t.type&&i===c.OVERLAP&&this.selectFileWindowWhenDragOver(t.ev,s),"drop"===t.type))switch(this.targetWindow=null,i){case c.NEW:this.dropToCreateFileWindow(s);break;case c.ADD:this.dropToAddMediaToFileWindow(t.ev,s);break;case c.OVERLAP:this.dropToPreviewer(t.ev,s);break;case c.PAGE:this.dropToAddPageAndCreateFileWindow(s);break;default:return}}}return e.ngInjectableDef=l.tc({factory:function(){return new e(l.xc(a.b))},token:e,providedIn:"root"}),e})()}}]);