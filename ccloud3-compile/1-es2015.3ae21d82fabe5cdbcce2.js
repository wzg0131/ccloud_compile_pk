(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"2ARg":function(e,t,i){"use strict";i.d(t,"a",function(){return n});var s=i("2Vo4"),l=i("8Y7J");const n=(()=>{class e{constructor(){this.eventSource=new s.a(null),this.events$=this.eventSource.asObservable()}emit(e){this.eventSource.next(e)}}return e.ngInjectableDef=l.Qb({factory:function(){return new e},token:e,providedIn:"root"}),e})()},"3aSq":function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i("xj3x");class s{constructor(e,t,i){this.el=e,this.dragDropService=t,this.cdRef=i,this.element=this.el.nativeElement,this.dragDropService.showOuterHighLight.subscribe(e=>{0!==t.dragTargets.length&&(e?(this.cdRef.detach(),"start"===e.type&&this.addOuterElement(),e.rect&&this.scale&&this.scaleTo(e.rect.Width*e.scale,e.rect.Height*e.scale,e.rect.Y*e.scale,e.rect.X*e.scale)):(this.cdRef.reattach(),this.removeOuterElement()))})}scaleTo(e,t,i,s){this.outerElement&&(this.outerElement.style.width=e+"px",this.outerElement.style.height=t+"px",this.outerElement.style.top=i+"px",this.outerElement.style.left=s+"px",this.outerElement.style.right=null,this.outerElement.style.bottom=null)}createOuterElement(){const e=document.createElement("div");if(e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.right="0",e.style.bottom="0",e.style.pointerEvents="none",e.style.textAlign="center",e.style.fontSize="24px",e.style.lineHeight="30px",e.style.transition="200ms",this.color?(e.style.border=`4px dashed ${this.color}`,e.style.color=this.color):(e.style.border="4px dashed red",e.style.color="red"),this.text&&(e.innerText=this.text),this.styleSheet&&"object"==typeof this.styleSheet)for(const t of Object.keys(this.styleSheet))e.style[t]=this.styleSheet[t];return e}addOuterElement(){this.outerElement&&this.outerElement.parentNode===this.element||(this.outerElement=this.createOuterElement(),this.element.appendChild(this.outerElement))}removeOuterElement(){this.outerElement&&this.outerElement.parentNode===this.element&&this.outerElement.parentNode.removeChild(this.outerElement)}}},JjIB:function(e,t,i){"use strict";i.d(t,"a",function(){return n});var s=i("8Y7J"),l=(i("xj3x"),i("xgIS"));class n{constructor(e,t,i,n){this.elRef=e,this.dragDropService=t,this.ngZone=i,this.cdRef=n,this.dropEmitter=new s.m,this.element=e.nativeElement,this.ngZone.runOutsideAngular(()=>{this.dragoverSub=Object(l.a)(this.element,"dragover").subscribe(e=>{this.onDragOver(e)}),this.dragenterSub=Object(l.a)(this.element,"dragenter").subscribe(e=>{this.onDragEnter(e)}),this.dragleaveSub=Object(l.a)(this.element,"dragleave").subscribe(e=>{this.onDragLeave(e)})})}onDragOver(e){e.preventDefault(),e.target===this.element&&this.dropEmitter.emit({type:"over",data:null,ev:e})}onDrop(e){e.preventDefault(),e.target===this.element&&(this.backToNormal(this.element.children),this.dropEmitter.emit({type:"drop",data:this.dragDropService.dragTargets,ev:e}),this.cdRef.reattach())}onDragLeave(e){e.preventDefault(),e.target===this.element&&(this.backToNormal(this.element.children),this.dropEmitter.emit({type:"leave",data:null,ev:e}),this.cdRef.reattach())}onDragEnter(e){e.preventDefault(),this.forbiddenChildPointerEvents(this.element.children),this.element===e.target&&(this.cdRef.detach(),this.dropEmitter.emit({type:"enter",data:null,ev:e}))}forbiddenChildPointerEvents(e){for(let t=0;t<e.length;t++)e[t].style.pointerEvents="none"}backToNormal(e){for(let t=0;t<e.length;t++)e[t].style.pointerEvents="auto"}ngOnDestroy(){this.dragoverSub&&this.dragoverSub.unsubscribe(),this.dragenterSub&&this.dragenterSub.unsubscribe(),this.dragleaveSub&&this.dragleaveSub.unsubscribe()}}},KuJF:function(e,t,i){"use strict";i.d(t,"a",function(){return l});var s=i("XNiG");class l{constructor(e,t){this.selectChange=new s.a,this.lastIndex=null,this._selected=t,this._selected.length>1&&(this._multiStatus=!0),this.dataSource=e}get selected(){return this._selected}clickTarget(e,t,i){if(i&&(this._multiStatus=!0),e.shiftKey)this.shiftSelect(t),this._multiStatus=!0;else if(e.ctrlKey)this.ctrSelect(t),this._multiStatus=!0;else{if(this._multiStatus)this.toggleSelect(t);else{const e=this._selected.filter(e=>e.id!==t.id);this.groupDeselect(e),this.toggleSelect(t)}const e=this.findIndex(t,this.dataSource);this.lastIndex=e>-1?e:null}}groupSelect(e){e.forEach(e=>{this.select(e)}),this._multiStatus=!0}groupDeselect(e){e.forEach(e=>{this.deselect(e)})}isSelected(e){return!!this._selected.find(t=>t.id===e.id)}getSelectedNumFrom(e){let t=0;return e.forEach(e=>{this.isSelected(e)&&(t+=1)}),t}get isMultiStatus(){return this._multiStatus}clear(){this._multiStatus=!1,this._selected=[]}toggleSelect(e){this.isSelected(e)?this.deselect(e):this.select(e)}select(e){if(!this.isSelected(e)){const t=this._selected.slice();t.push(e),this._selected=t}this.selectChange.next(this._selected)}deselect(e){const t=this.findIndex(e,this._selected);if(t>-1){const e=this._selected.slice();e.splice(t,1),this._selected=e}this.selectChange.next(this._selected)}shiftSelect(e){const t=this.findIndex(e,this.dataSource);if(-1===t)return;const i=null!==this.lastIndex?this.lastIndex:t;this.dataSource.slice(Math.min(t,i),Math.max(t,i)+1).forEach(e=>{this.ctrSelect(e)})}ctrSelect(e){this.select(e)}findIndex(e,t){return t.findIndex(t=>t.id===e.id)}}},St6j:function(e,t,i){"use strict";i.d(t,"a",function(){return h}),i.d(t,"b",function(){return c}),i("g0Zh"),i("w6Hz"),i("5fUb"),i("IyOr"),i("AfRD"),i("kJ5x"),i("JDDX"),i("2ARg");var s=i("AytR"),l=i("qV8f"),n=i("XNiG"),r=i("LvDl"),a=i("1G5W"),o=i("KuJF");class h{static showMediaFilter(e){return e.hover||e.menuExpanded||e.groupChoose||e.partChoose}static showContentFilter(e,t,i){return e.hover||e.menuExpanded||t.some(e=>i.findIndex(t=>t.id===e.id)>-1)}static mouseEnterFilter(e){e.hover=!0}static mouseLeaveFilter(e){e.hover=!1}static menuOpen(e){e.menuExpanded=!0}static menuClose(e){e.hover=!1,e.menuExpanded=!1}}class c{constructor(e,t,i,s,l,h,c,d,u,g,m,f,p,b){this.mediaService=e,this.dialogRef=t,this.el=i,this.nav=s,this.infoService=l,this.router=h,this.createMedia=c,this.program=d,this.flowService=u,this.crequest=g,this.tracker=m,this.ele=f,this.store=p,this.cdR=b,this.medias=[],this.params={_embed:"true",per_page:"12",page:"1",status:"any"},this.isPC=!0,this.mediaSelected=[],this.destroy$=new n.a,this.store.select(e=>e.mediaData.mediaSelected).pipe(Object(a.a)(this.destroy$)).subscribe(e=>{this.mediaSelected=r.cloneDeep(e),0===e.length&&this.unSelect()}),this.store.select(e=>e.mediaData.media).pipe(Object(a.a)(this.destroy$)).subscribe(e=>{e.length>0&&(this.selectionModel=new o.a(e,this.mediaSelected))})}ngAfterViewChecked(){this.cdR.detectChanges()}dispatchSelectedChange(){this.store.dispatch(Object(l.c)({selected:this.mediaSelected})),this.store.dispatch(Object(l.b)({selected:[]}))}showPreview(e){this.mediaService.updateSelectMedia(e,this.medias)}create(e){this.createMedia.sendMedia([e]),this.router.navigate(["/create",{type:"file"}])}download(e){const t=document.createElement("a"),i=document.createEvent("HTMLEvents");i.initEvent("click",!1,!1),t.href=e.source_url,t.download=e.name,t.dispatchEvent(i),t.click()}onSelect(){return!1}ngOnInit(){this.url=s.a.apiEndpoint+"/wp-json/wp/v2/programs/",this.listenClickEvent(),this.isPC=this.IsPC()}IsPC(){const e=navigator.userAgent,t=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];let i=!0;for(let s=0;s<t.length;s++)if(e.indexOf(t[s])>0){i=!1;break}return i}listenClickEvent(){this.tracker.events$.subscribe(e=>{e&&e.uniqueKey&&"MEDIA"===e.uniqueKey&&this.unSelect()})}unSelect(){this.mediaService.selectMedia={name:"",src:""},this.selectionModel&&this.selectionModel.clear()}clickMedia(e,t,i){this.selectionModel.clickTarget(e,t,i),this.mediaSelected=this.selectionModel.selected,this.mediaService.selectMedia=t,this.store.dispatch(Object(l.l)({id:this.mediaSelected.length>0?t.id:null})),this.dispatchSelectedChange()}clickCheckbox(e,t){e.stopPropagation(),this.clickMedia(e,t,!0)}All(e){this.selectionModel.groupSelect(e.value),this.mediaSelected=this.unique(e.value),this.selectionModel.groupSelect(this.mediaSelected),this.dispatchSelectedChange()}unique(e){return r.uniqWith(e.concat(this.mediaSelected),r.isEqual)}None(e){this.selectionModel.groupDeselect(e.value),this.mediaSelected=this.mediaSelected.filter(t=>!e.value.find(e=>e.id===t.id)),this.dispatchSelectedChange()}ifProgram(e,t){t.selectNum=0,this.None(t);const i=t.value.filter(e=>e.attachment_program_detail.length>0),s=t.value.filter(e=>!(e.attachment_program_detail.length>0));e?(this.selectionModel.groupDeselect(s),this.selectionModel.groupSelect(i)):(this.selectionModel.groupDeselect(i),this.selectionModel.groupSelect(s)),this.mediaSelected=this.selectionModel.selected,this.dispatchSelectedChange()}ifSelectGroupAll(e){return e.value.length===this.selectionModel.getSelectedNumFrom(e.value)}ifSelectGroupSome(e){const t=e.value.length,i=this.selectionModel.getSelectedNumFrom(e.value);return i>0&&i<t}toggleMediaFilter(e,t){e.showFilter=t}ifShowMediaFilter(e){return!!e.menuExpened||e.showFilter||this.selectionModel.getSelectedNumFrom(e.value)>0}filterMenuToggle(e,t){e.menuExpened=t}toggleMediaCheckbox(e,t){e.showCheckBox=!!this.selectionModel.isMultiStatus||t}ifMediaSelected(e){return this.selectionModel.isSelected(e)}ifShowCheckBox(e){return!!e.showCheckBox||this.selectionModel.isMultiStatus}filterItem(e){this.ifSelectGroupAll(e)?this.None(e):this.All(e)}trackById(e,t){return t.id+e}ngOnChanges(e){if(void 0!==e.medias){const t=e.medias.currentValue;this.previewMedias=t,this.medias=t}}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.store.dispatch(Object(l.c)({selected:[]}))}}},c7dS:function(e,t,i){"use strict";var s=i("8Y7J"),l=i("Z5h4"),n=i("s7LF"),r=i("r0V8"),a=i("5GAg"),o=i("omvX"),h=i("6UMx"),c=i("Q+lL"),d=i("5ATD"),u=i("nHm3"),g=i("xj3x"),m=i("SVse"),f=i("TSSN"),p=i("15B3"),b=i("EoEU"),S=i("FYhI");i("j55m"),i.d(t,"a",function(){return v}),i.d(t,"b",function(){return O});var v=s.sb({encapsulation:0,styles:[[".drag-list-container[_ngcontent-%COMP%]{position:relative}.drag-list-container[_ngcontent-%COMP%]   .program-list[_ngcontent-%COMP%]{position:relative;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.drag-list-container[_ngcontent-%COMP%]   .program-list[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:flex-start;height:41px}.drag-list-container[_ngcontent-%COMP%]   .program-list[_ngcontent-%COMP%]   .section-header[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{position:absolute;top:10px;left:30px;color:#777777ab}.drag-list-container[_ngcontent-%COMP%]   .program-row[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;justify-content:flex-start}"]],data:{}});function w(e){return s.Ob(0,[(e()(),s.ub(0,0,null,null,2,"mat-checkbox",[["class","mat-checkbox"]],[[8,"id",0],[1,"tabindex",0],[2,"mat-checkbox-indeterminate",null],[2,"mat-checkbox-checked",null],[2,"mat-checkbox-disabled",null],[2,"mat-checkbox-label-before",null],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"change"]],function(e,t,i){var s=!0,l=e.component;return"click"===t&&(s=!1!==i.stopPropagation()&&s),"change"===t&&(s=!1!==(i?l.toggleSection(e.parent.context.$implicit):null)&&s),s},l.b,l.a)),s.Jb(5120,null,n.p,function(e){return[e]},[r.b]),s.tb(2,8568832,null,0,r.b,[s.k,s.h,a.h,s.y,[8,null],[2,r.a],[2,o.a]],{checked:[0,"checked"],indeterminate:[1,"indeterminate"]},{change:"change"})],function(e,t){var i=t.component;e(t,2,0,i.isSectionAllSelected(t.parent.context.$implicit),i.isSectionSelected(t.parent.context.$implicit))},function(e,t){e(t,0,0,s.Eb(t,2).id,null,s.Eb(t,2).indeterminate,s.Eb(t,2).checked,s.Eb(t,2).disabled,"before"==s.Eb(t,2).labelPosition,"NoopAnimations"===s.Eb(t,2)._animationMode)})}function x(e){return s.Ob(0,[(e()(),s.ub(0,0,null,null,2,"mat-checkbox",[["class","mat-checkbox"]],[[8,"id",0],[1,"tabindex",0],[2,"mat-checkbox-indeterminate",null],[2,"mat-checkbox-checked",null],[2,"mat-checkbox-disabled",null],[2,"mat-checkbox-label-before",null],[2,"_mat-animation-noopable",null]],[[null,"click"],[null,"change"]],function(e,t,i){var s=!0,l=e.component;return"click"===t&&(s=!1!==i.stopPropagation()&&s),"change"===t&&(s=!1!==l.selectChange(e.parent.context.$implicit)&&s),s},l.b,l.a)),s.Jb(5120,null,n.p,function(e){return[e]},[r.b]),s.tb(2,8568832,null,0,r.b,[s.k,s.h,a.h,s.y,[8,null],[2,r.a],[2,o.a]],{checked:[0,"checked"]},{change:"change"})],function(e,t){e(t,2,0,t.component.selection.isSelected(t.parent.context.$implicit))},function(e,t){e(t,0,0,s.Eb(t,2).id,null,s.Eb(t,2).indeterminate,s.Eb(t,2).checked,s.Eb(t,2).disabled,"before"==s.Eb(t,2).labelPosition,"NoopAnimations"===s.Eb(t,2)._animationMode)})}function E(e){return s.Ob(0,[(e()(),s.ub(0,0,null,null,0,null,null,null,null,null,null,null))],null,null)}function D(e){return s.Ob(0,[(e()(),s.ub(0,0,null,null,10,"mat-list-item",[["appDrag",""],["appInout",""],["class","program-row mat-list-item"],["role","listitem"]],[[2,"mat-list-item-avatar",null],[2,"mat-list-item-with-avatar",null]],[[null,"mouseenter"],[null,"mouseleave"],[null,"click"],[null,"dragstart"],[null,"dragend"]],function(e,t,i){var l=!0,n=e.component;return"dragstart"===t&&(l=!1!==s.Eb(e,6).onDragStart(i)&&l),"dragend"===t&&(l=!1!==s.Eb(e,6).ondragend(i)&&l),"mouseenter"===t&&(l=0!=(e.context.$implicit.hover=!0)&&l),"mouseleave"===t&&(l=0!=(e.context.$implicit.hover=!1)&&l),"click"===t&&(l=!1!==n.selectChange(e.context.$implicit)&&l),l},h.f,h.b)),s.tb(1,1228800,null,3,c.c,[s.k,s.h,[2,c.g],[2,c.a]],null,null),s.Kb(603979776,2,{_lines:1}),s.Kb(603979776,3,{_avatar:0}),s.Kb(603979776,4,{_icon:0}),s.tb(5,16384,null,0,d.a,[s.k],null,null),s.tb(6,16384,null,0,u.a,[s.k,g.a],{currentTarget:[0,"currentTarget"],selected:[1,"selected"]},null),(e()(),s.jb(16777216,null,2,1,null,x)),s.tb(8,16384,null,0,m.n,[s.P,s.M],{ngIf:[0,"ngIf"]},null),(e()(),s.jb(16777216,null,2,1,null,E)),s.tb(10,540672,null,0,m.u,[s.P],{ngTemplateOutletContext:[0,"ngTemplateOutletContext"],ngTemplateOutlet:[1,"ngTemplateOutlet"]},null)],function(e,t){var i=t.component;e(t,6,0,t.context.$implicit,i.selection.selected),e(t,8,0,i.ifShowCheckbox(t.context.$implicit)),e(t,10,0,t.context.$implicit,i.template)},function(e,t){e(t,0,0,s.Eb(t,1)._avatar||s.Eb(t,1)._icon,s.Eb(t,1)._avatar||s.Eb(t,1)._icon)})}function y(e){return s.Ob(0,[(e()(),s.ub(0,0,null,null,10,null,null,null,null,null,null,null)),(e()(),s.ub(1,0,null,null,9,"mat-list",[["class","program-list mat-list mat-list-base"],["role","list"]],null,null,null,h.h,h.a)),s.tb(2,704512,null,0,c.a,[s.k],null,null),(e()(),s.ub(3,0,null,0,5,"div",[["class","section-header"]],null,[[null,"click"],[null,"mouseenter"],[null,"mouseleave"]],function(e,t,i){var s=!0,l=e.component;return"click"===t&&(s=!1!==l.toggleSection(e.context.$implicit)&&s),"mouseenter"===t&&(s=!1!==l.filterController.mouseEnterFilter(e.context.extra)&&s),"mouseleave"===t&&(s=!1!==l.filterController.mouseLeaveFilter(e.context.extra)&&s),s},null,null)),(e()(),s.jb(16777216,null,null,1,null,w)),s.tb(5,16384,null,0,m.n,[s.P,s.M],{ngIf:[0,"ngIf"]},null),(e()(),s.ub(6,0,null,null,2,"h5",[],null,null,null,null,null)),(e()(),s.Mb(7,null,[""," ",""])),s.Gb(131072,f.i,[f.j,s.h]),(e()(),s.jb(16777216,null,0,1,null,D)),s.tb(10,278528,null,0,m.m,[s.P,s.M,s.r],{ngForOf:[0,"ngForOf"]},null)],function(e,t){var i=t.component;e(t,5,0,i.filterController.showContentFilter(t.context.extra,t.context.$implicit,i.selection.selected)),e(t,10,0,t.context.$implicit)},function(e,t){e(t,7,0,t.context.date,s.Nb(t,7,1,s.Eb(t,8).transform(t.context.day)))})}function O(e){return s.Ob(0,[(e()(),s.ub(0,0,null,null,5,"div",[["class","drag-list-container"]],null,null,null,null,null)),(e()(),s.ub(1,0,null,null,4,"app-group-splitter",[],null,null,null,p.b,p.a)),s.tb(2,49152,null,1,b.a,[],{groupStrategy:[0,"groupStrategy"],groupData:[1,"groupData"]},null),s.Kb(335544320,1,{subGroup:0}),(e()(),s.jb(16777216,null,null,1,null,y)),s.tb(5,16384,[[1,4]],0,S.a,[s.M,s.P],null,null)],function(e,t){var i=t.component;e(t,2,0,i.groupBy,i.contents)},null)}},j55m:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i("xj3x");var s=i("EoEU"),l=i("St6j");class n{constructor(e){this.dragService=e,this.contents=[],this.groupBy=s.b.MODIFIED,this.filterController=l.a}isSectionAllSelected(e){return this.getSectionSelectLength(e)===e.length}isSectionSelected(e){const t=this.getSectionSelectLength(e);return t>0&&t<e.length}getSectionSelectLength(e){return this.selection.selected.filter(t=>{for(let i=0;i<e.length;i++)if(e[i].id===t.id)return!0}).length}toggleSection(e){this.isSectionAllSelected(e)?this.clearSection(e):this.selectSection(e),this.drawText()}selectChange(e){this.selection.toggle(e),this.drawText()}drawText(){this.dragService.draw(this.selection.selected.length)}clearSection(e){for(let t=0;t<e.length;t++)this.selection.deselect(e[t])}selectSection(e){for(let t=0;t<e.length;t++)this.selection.isSelected(e[t])||this.selection.select(e[t])}ifShowCheckbox(e){return!!this.selection.hasValue()||!!e.hover}}},nHm3:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i("xj3x");class s{constructor(e,t){this.elRef=e,this.dragDropService=t,this.reorderIndex=null,this.element=e.nativeElement,this.element.getAttribute("draggable")||this.element.setAttribute("draggable","true")}onDragStart(e){this.dragDropService.clear();const t=e.dataTransfer;if(t.effectAllowed="copy",!(this.currentTarget&&this.selected instanceof Array))return!1;this.selected.length>1&&this.selected.filter(e=>e.id===this.currentTarget.id).length>0?(t.setDragImage(this.dragDropService.dragImage,0,0),this.dragDropService.addAll(this.selected)):this.dragDropService.add(this.currentTarget),e.dataTransfer.setData("reorder",this.reorderIndex+""),null===this.reorderIndex&&this.dragDropService.showOuterHighLight.next({type:"start"})}ondragend(e){null===this.reorderIndex&&this.dragDropService.dragEndInit()}}},pH6K:function(e,t,i){"use strict";i.d(t,"a",function(){return s}),i("g0Zh");class s{constructor(e,t,i,s,l){this.mediaService=e,this.el=t,this.renderer2=i,this.dialog=s,this.data=l,this.selected=[],this.folders=[],this.folderSelected=[],this.moveTo=!1,this.loading=!1,this.path=[void 0],this.lastPath=void 0,this.showRoot=!1,this.showRight=!1,l&&(this.folderSelected=l.folderSelected,this.selected=l.selected.map(e=>e.id),l.folders?this.folders=l.folders:this.mediaService.getMediaFolders(1,100).subscribe(e=>{this.folders=e.folders,this.mediaService.allFolders=e.folders}))}disableFolder(e){return this.folderSelected.map(e=>e.id).indexOf(e)>-1}cancel(){this.dialog.close()}moveMedia(){this.moveTo=!1,0===this.select&&0===this.folderSelected.length&&(this.select=[]),this.selected.forEach(e=>{this.mediaService.moveTo(e,this.select).subscribe(e=>{this.dialog.close(e)})});const e={title:"",description:""};this.folderSelected.forEach(t=>{e.title=t.name,e.description=t.description,this.mediaService.moveFolder(this.select,t.id,e).subscribe(e=>{this.dialog.close(!0)})})}backPath(){this.loading=!0,void 0===this.lastPath?(this.showRoot=!0,this.lastPath=void 0,this.loading=!1,this.select=void 0):(this.showRoot=!1,this.mediaService.getMediaFolders(1,100,this.lastPath).subscribe(e=>{this.folders=e.folders,this.loading=!1,this.select=this.lastPath,this.path.pop(),this.lastPath=this.path[this.path.length-1]}))}enterFolder(e){this.select=e.id,this.loading=!0,0===e.id?(this.showRoot=!1,this.loading=!1):(this.lastPath=e.parent,this.path.push(this.lastPath),this.mediaService.getMediaFolders(1,100,e.id).subscribe(e=>{this.folders=e.folders,this.loading=!1}))}selectFolder(e){this.select=e===this.select?void 0:e}ngOnInit(){}}},qSGc:function(e,t,i){"use strict";i.d(t,"a",function(){return s});var s=function(e){return e.ADMINISTRATOR="administrator",e.EDITOR="editor",e.MANAGER="manager",e.AUDITOR="auditor",e.CONTRIBUTOR="contributor",e.SUBSCRIBER="subscriber",e.SUPERVISOR="supervisor",e.MONITOR="monitor",e.INVITEE="invitee",e.GUEST="guest",e.TERMINAL="terminal",e}({})},uBgS:function(e,t,i){"use strict";i.d(t,"a",function(){return n}),i.d(t,"c",function(){return r}),i.d(t,"b",function(){return a}),i("l9NK"),i("4FSw");var s=i("y58h"),l=(i("NQG6"),i("+bt8"),i("KXJF"),i("DQLy"));i("fz2B");const n=Object(l.x)(e=>e.mediaData,s.c),r=Object(l.x)(e=>e.mediaData,s.e),a=(Object(l.x)(e=>e.mediaData,s.b),Object(l.x)(e=>e.mediaData,s.d));Object(l.x)(e=>e.mediaData,s.a),Object(l.x)(e=>e.mediaData,s.g)},w6Hz:function(e,t,i){"use strict";i.d(t,"a",function(){return f});var s=i("8Y7J"),l=i("g0Zh"),n=i("pH6K"),r=(i("5fUb"),i("IyOr"),i("0gu+"),i("udsX")),a=i("MwwG"),o=i("xdDY"),h=i("uBgS"),c=i("qV8f"),d=i("Nr6V"),u=i("ELAf"),g=i("qSGc"),m=i("LvDl");class f{constructor(e,t,i,n,a,o,c,d,u){this.infoService=e,this.mediaService=t,this.router=i,this.dialogRef=n,this.createMedia=a,this.authService=o,this.dialog=c,this.store=d,this.el=u,this.folders=[],this.isListView=!1,this.metaCaps={create:[r.a.CREATE_PROGRAM],delete:[r.a.READ_LOGS]},this.listView=new s.m,this.allowShareRoles=[g.a.ADMINISTRATOR,g.a.EDITOR,g.a.MANAGER],this.currentUser=this.authService.User,this.showDetailSub=this.store.select(e=>e.mediaData.ifShowDetail).subscribe(e=>{if(void 0===this.ifShowDetail){const e=localStorage.getItem("mediaDetail");e&&(this.ifShowDetail=JSON.parse(e).ifShowDetail)}else this.ifShowDetail=e}),this.delSub=this.mediaService.judgeDelete.subscribe(e=>{this.canbeDelete=e}),this.fiSub=this.mediaService.finishDeleteMedia.subscribe(e=>{this.canbeDelete=!e,e&&this.clearSelect()}),this.mediaFolderChange=this.store.select(h.b).subscribe(e=>{if(this.folders=m.cloneDeep(e.folders),this.folderPath=this.folderPath?e.folderPath:l.a.getLocalFolderPath(),"number"!=typeof e.currentFolderId){const e=l.a.getLocalParams();this.parentNodeId="number"==typeof e.mfolder?e.mfolder:0}else this.parentNodeId=0}),this.mediaQueryParamsSub=this.store.select(e=>e.mediaData.mediaQueryParams).subscribe(e=>{this.mediaQueryParams=this.mediaQueryParams?e:l.a.getLocalParams()}),this.mediaStatusSub=this.store.select(e=>e.mediaData.mediaStatus).subscribe(e=>{this.mediaStatus=this.mediaStatus?e:l.a.getLocalMediaStatus()}),this.mediaSelectedChangeSub=this.store.select(e=>e.mediaData.mediaSelected).subscribe(e=>{this.mediaSelected=m.cloneDeep(e)}),this.folderSelectedChangeSub=this.store.select(e=>e.mediaData.folderSelected).subscribe(e=>{this.folderSelected=m.cloneDeep(e)})}ngOnDestroy(){this.showDetailSub.unsubscribe(),this.fiSub.unsubscribe(),this.delSub.unsubscribe(),this.mediaFolderChange.unsubscribe(),this.mediaQueryParamsSub.unsubscribe(),this.mediaStatusSub.unsubscribe(),this.mediaSelectedChangeSub.unsubscribe(),this.folderSelectedChangeSub.unsubscribe(),this.el.nativeElement.onclick=null}clearSelect(){this.store.dispatch(Object(c.c)({selected:[]})),this.store.dispatch(Object(c.b)({selected:[]}))}showPreview(){this.mediaService.updateSelectMedia(this.mediaService.selectMedia)}get ifShowNavBar(){return"upload"!==this.mediaService.selectedTab}paramChange(e){this.mediaSearchParams=l.a.setSearchParam(e),this.store.dispatch(Object(c.k)({params:this.mediaSearchParams})),l.a.ifSearch(this.mediaSearchParams)?this.store.dispatch(Object(c.j)({params:this.mediaSearchParams})):this.store.dispatch(Object(c.d)({params:this.mediaQueryParams})),this.store.dispatch(Object(c.c)({selected:[]}))}refreshMedia(){this.mediaStatus===d.a.SEARCH?this.store.dispatch(Object(c.j)({params:this.mediaSearchParams})):this.mediaStatus===d.a.QUERY&&this.store.dispatch(Object(c.d)({params:this.mediaQueryParams})),this.store.dispatch(Object(c.c)({selected:[]}))}toggleDetail(){this.ifShowDetail=!this.ifShowDetail,this.store.dispatch(Object(c.l)({open:this.ifShowDetail,id:null}))}changeView(){this.isListView=!this.isListView,this.listView.emit([this.isListView]),localStorage.setItem("ListView",JSON.stringify(this.isListView))}moveToFolder(e,t){this.folders=this.mediaService.allFolders;const{dialogRef:i,dialogConfig:s}=this;e&&(s.data.selected=[e],s.data.folderSelected=[]),t&&(s.data.selected=[],s.data.folderSelected=[t]),this.mediaSelected.length>0&&(s.data.selected=this.mediaSelected),this.folderSelected&&this.folderSelected.length>0&&(s.data.folderSelected=this.folderSelected),i.open(n.a,s).afterClosed().subscribe(e=>{e&&(this.store.dispatch(Object(c.d)({params:{}})),this.store.dispatch(Object(c.c)({selected:[]})))})}getSelectedMediaExceptZip(){const e=this.mediaSelected;for(let t=0;t<e.length;t++)if(this.mediaService.isUpgradePackage(e[t].file_type))return[];return e}canBeCreateProgram(){return this.getSelectedMediaExceptZip().length>0}createFile(){if(!this.currentUser.hasCapability(r.a.CREATE_PROGRAM))return!1;this.createMedia.sendMedia(this.getSelectedMediaExceptZip()),this.router.navigate(["/create",{type:"file"}])}get dialogConfig(){const{mediaSelected:e,folders:t,folderSelected:i}=this;return{data:{mediaSelected:e,folders:t,folderSelected:i},width:"300px"}}deleteFiles(e,t){"media"===t?this.mediaService.deleteMedia(e[0]).subscribe(()=>{this.refreshMedia()}):"medias"===t?this.mediaService.bulkDeleteMedia(e).subscribe(()=>{this.refreshMedia()}):"folder"===t&&this.mediaService.bulkDeleteFolders(e).subscribe(e=>{this.store.dispatch(Object(c.f)({folderId:this.parentNodeId,param:{type:"refresh",folderPath:this.folderPath}})),this.store.dispatch(Object(c.d)({params:{}})),this.store.dispatch(Object(c.c)({selected:[]}))})}bulkDeleteMedias(){let e,t,i,s=[];1===this.mediaSelected.length&&(s=[this.mediaSelected[0].id],e=this.mediaSelected[0],t=!0,i="media"),this.mediaSelected.length>1&&(s=this.mediaSelected.map(e=>e.id),e={length:this.mediaSelected.length},t=!1,i="medias"),this.folderSelected.length>0&&(s=this.folderSelected.map(e=>e.id),1===this.folderSelected.length?(e=this.folderSelected[0],t=!0):(e={length:this.folderSelected.length},t=!1),i="folder"),this.dialog.open(a.a,{width:"450px",data:{file_info:e,isSingle:t,from:i}}).afterClosed().subscribe(e=>{e&&e.delete&&this.deleteFiles(s,e.type)})}ngOnInit(){this.isListView=JSON.parse(localStorage.getItem("ListView")),this.el.nativeElement.onclick=(()=>{this.store.dispatch(Object(c.c)({selected:[]}))})}ngOnChanges(e){void 0!==e.singleSelectG&&0!==e.singleSelectG.currentValue.length&&(this.canbeDelete=0===e.singleSelectG.currentValue[0].attachment_program.length),void 0!==e.singleSelect&&0!==e.singleSelect.currentValue.length&&(this.canbeDelete=0===e.singleSelect.currentValue[0].attachment_program.length)}canbeMoveToFolder(){return"share"!==this.mediaService.selectedTab&&(this.mediaSelected.length>0||this.folderSelected.length>0)}canbeBulkDeleteMedias(){return(this.folderSelected.length>0||l.a.judge(this.mediaSelected))&&"own"===this.mediaService.selectedTab}canShowPreview(){return 1===this.mediaSelected.length}get canShowBindTags(){return this.mediaSelected.length>0&&"own"===this.mediaService.selectedTab}bindTags(){this.dialog.open(o.a,{data:{media:this.mediaSelected},disableClose:!0,width:"400px"})}get ifShowShareTo(){return this.mediaSelected.length>0&&0===this.mediaSelected.filter(e=>"zip"===e.file_type).length&&"own"===this.mediaService.selectedTab}shareTo(){this.dialog.open(u.a,{width:"800px",height:"500px",data:{media:this.mediaSelected.map(e=>e.id)}})}}},xj3x:function(e,t,i){"use strict";i.d(t,"b",function(){return a}),i.d(t,"c",function(){return o}),i.d(t,"a",function(){return h});var s=i("GmxD"),l=i("2Vo4"),n=i("8Y7J"),r=i("lwm9"),a=function(e){return e[e.LIST=0]="LIST",e[e.GRID=1]="GRID",e}({}),o=function(e){return e[e.NEW=0]="NEW",e[e.ADD=1]="ADD",e[e.OVERLAP=2]="OVERLAP",e[e.PAGE=3]="PAGE",e}({});const h=(()=>{class e{constructor(e){this._bottomSheet=e,this.dragTargets=[],this.showOuterHighLight=new l.a(null),this.tipRectColor={new:"red",add:"blue",multi:"yellow",page:"green"},this.insertIndex=0}dragEndInit(){this.showOuterHighLight.next(null),this.clear()}clear(){this.dragTargets=[]}add(e){this.dragTargets.push(e)}addAll(e){this.dragTargets=this.dragTargets.concat(e)}createCanvas(){const e=document.createElement("canvas");e.width=50,e.height=50,this.canvas=e}draw(e){this.createCanvas();const t=this.canvas.getContext("2d");t.beginPath(),t.fillStyle="red",t.arc(this.canvas.width/2,this.canvas.height/2,this.canvas.width/2,0,2*Math.PI),t.fill(),t.font=this.canvas.width+"px serif",t.fillStyle="#fff",t.textBaseline="hanging",t.textAlign="center",t.fillText(e,this.canvas.width/2,2),this.dragImage=new Image,this.dragImage.src=this.canvas.toDataURL("image/png",1)}dropToCreateFileWindow(e){e.windows.add("fileWindow"),this.addMediaToFileWindow(e)}dropToAddMediaToFileWindow(e,t){if(0===t.windows.get().length)return;const i=e.dataTransfer.getData("reorder");if("null"!==i){const e=t.windows.getSelected().children,s=e[i],l=this.getReorderIndex(e.length);return e[i]=e[l],void(e[l]=s)}const s=e.target;this.addMediaToFileWindow(t,null,0===s.offsetWidth?s.children[0]:s)}getReorderIndex(e){return this.insertIndex<=0?0:this.insertIndex>e-1?e-1:this.insertIndex-1}getListViewDropIndex(e){const t=e.offsetY,i=Math.floor(t/108);let s=i;return t>108*i+54&&(s+=1),this.listHighLight(e.target,s,108),s}getGridViewDropIndex(e){const t=0===e.target.offsetWidth?e.target.children[0]:e.target,i=t.offsetWidth,s=t.children.length;if(0===s)return 0;let l=e.offsetX,n=Math.ceil(e.offsetY/104);const r=Math.floor(i/104);let a=Math.floor(l/104);a>=r&&(n+=1,a=0,l=0);let o=(n-1)*r+a;return o>s-2&&(a=s-1-(n-1)*r),l>104*a+52&&o<=s-2&&(o+=1,a+=1),this.gridHighLight(t,n,a,104),o}gridHighLight(e,t,i,s){this.highLightElement&&this.highLightElement.parentNode===e||(this.highLightElement=this.createElement(5,s),e.appendChild(this.highLightElement)),this.highLightElement.style.left=i*s+"px",this.highLightElement.style.top=(t-1)*s+"px"}listHighLight(e,t,i){this.highLightElement&&this.highLightElement.parentNode===e||(this.highLightElement=this.createElement(e.offsetWidth,5),this.highLightElement.style.left="0px",e.appendChild(this.highLightElement)),this.highLightElement.style.top=t*i+"px"}createElement(e,t){const i=document.createElement("div");return i.style.position="absolute",i.style.top="0",i.style.left="0",i.style.width=e+"px",i.style.height=t+"px",i.style.backgroundColor="#1A73E8",i}removeHighlight(e){this.highLightElement&&this.highLightElement.parentNode===e&&e.removeChild(this.highLightElement)}selectFileWindowWhenDragOver(e,t){const i=t.windows.get(),s=this.getFileWindow(i);if(0===s.length)return;const l=this.getTargetWindow(s,e,t);if(!l||0===l.length)return;const n=l[l.length-1];if(!this.targetWindow||this.targetWindow.window.id!==n.window.id){this.targetWindow=n;const e=t.getContentInfo().info.Information.Scale;this.showOuterHighLight.next({rect:n.window.Rect,scale:e})}}getTargetWindow(e,t,i){const s=i.getContentInfo();if(!s)return;const l=s.info.Information.Scale,n=t.offsetX/l,r=t.offsetY/l;return e.filter(e=>n>e.window.Rect.X&&n<e.window.Rect.X+e.window.Rect.Width&&r>e.window.Rect.Y&&r<e.window.Rect.Y+e.window.Rect.Height)}dropToPreviewer(e,t){const i=t.windows.get(),s=this.getFileWindow(i);if(0===s.length)this.dropToCreateFileWindow(t);else{const i=this.getTargetWindow(s,e,t);if(!i)return;0===i.length?this.dropToCreateFileWindow(t):this.addMediaToFileWindow(t,1===i.length?i[0]:i[i.length-1])}}dropToAddPageAndCreateFileWindow(e){e.pages.add().initWindow(),this.dropToCreateFileWindow(e)}getFileWindow(e){return e&&e instanceof Array?e.map((e,t)=>{if("fileWindow"===e.type)return{window:e,index:t}}).filter(e=>!!e):[]}addMediaToFileWindow(e,t,i){let s;t?(s=t.window,e.windows.select(t.index)):s=e.windows.getSelected();const l=this.dragTargets.map(e=>this.formatMedia(e)).filter(e=>!!e);s.children&&s.children instanceof Array?i&&this.insertIndex<i.children.length?s.children.splice(this.insertIndex,0,...l):s.children=s.children.concat(l):s.children=l,e.emit("pageInfoChanged")}formatMedia(e){return Object.assign({},e,{fileID:e.id,id:Math.random(),Duration:e.duration||8e3,ReserveAS:0,playTime:e.duration/1e3||8,PlayTimes:"1",inEffect:{Name:"No Effect",Type:0,Time:1500,webTime:1.5},attachment_filesize:this.formatSize(e.attachment_filesize)})}formatSize(e){return e>=1048576?(e/1048576).toFixed(2)+" MB":e<1048576?(e/1024).toFixed(0)+" KB":void 0}openTipDialog(e){return this.closeTipDialog(),this._bottomSheetRef=this._bottomSheet.open(s.a,{data:e,hasBackdrop:!1}),this._bottomSheetRef}closeTipDialog(){this._bottomSheetRef&&this._bottomSheetRef.dismiss()}handleEvent(e,t,i,s){if(0!==this.dragTargets.length&&("drop"===t.type||"leave"===t.type?i===o.ADD&&this.removeHighlight(0===t.ev.target.offsetWidth?t.ev.target.children[0]:t.ev.target):"over"===t.type&&i===o.ADD?this.insertIndex=t.viewType===a.GRID?this.getGridViewDropIndex(t.ev):this.getListViewDropIndex(t.ev):"over"===t.type&&i===o.OVERLAP&&this.selectFileWindowWhenDragOver(t.ev,s),"drop"===t.type))switch(this.targetWindow=null,i){case o.NEW:this.dropToCreateFileWindow(s);break;case o.ADD:this.dropToAddMediaToFileWindow(t.ev,s);break;case o.OVERLAP:this.dropToPreviewer(t.ev,s);break;case o.PAGE:this.dropToAddPageAndCreateFileWindow(s);break;default:return}}}return e.ngInjectableDef=n.Qb({factory:function(){return new e(n.Ub(r.b))},token:e,providedIn:"root"}),e})()}}]);